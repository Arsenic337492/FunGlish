<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í—Ö–æ–¥ –ø–æ —Å—Å—ã–ª–∫–µ | FunGlish</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="modal.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-left">
            <button onclick="location.href='index.html'">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="nav-icon">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M4.26 10.147a60.438 60.438 0 0 0-.491 6.347A48.62 48.62 0 0 1 12 20.904a48.62 48.62 0 0 1 8.232-4.41 60.46 60.46 0 0 0-.491-6.347m-15.482 0a50.636 50.636 0 0 0-2.658-.813A59.906 59.906 0 0 1 12 3.493a59.903 59.903 0 0 1 10.399 5.84c-.896.248-1.783.52-2.658.814m-15.482 0A50.717 50.717 0 0 1 12 13.489a50.702 50.702 0 0 1 7.74-3.342M6.75 15a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm0 0v-3.675A55.378 55.378 0 0 1 12 8.443m-7.007 11.55A5.981 5.981 0 0 0 6.75 15.75v-1.5" />
                </svg>
                FunGlish
            </button>
        </div>
    </nav>

    <main class="content" style="margin-left: 0; text-align: center; padding: 100px 20px;">
        <div class="welcome-message">
            <div id="signin-status">
                <h1>üîÑ –ó–∞–≤–µ—Ä—à–∞–µ–º –≤—Ö–æ–¥...</h1>
                <p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ</p>
            </div>
        </div>
    </main>

    <!-- Scripts -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <script src="script.js"></script>
    <script>
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥–∞ –ø–æ —Å—Å—ã–ª–∫–µ –∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const mode = urlParams.get('mode');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —ç—Ç–æ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –∏–ª–∏ –≤—Ö–æ–¥
            if (mode === 'verify') {
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ email
                firebase.auth().applyActionCode(urlParams.get('oobCode'))
                    .then(() => {
                        document.getElementById('signin-status').innerHTML = `
                            <h1>‚úÖ Email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω!</h1>
                            <p>–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –≤–æ–π—Ç–∏ —Å –ø–∞—Ä–æ–ª–µ–º.</p>
                            <button onclick="location.href='learning.html'" style="background: #1976D2; color: white; border: none; padding: 15px 30px; border-radius: 25px; font-size: 18px; cursor: pointer; margin-top: 20px;">
                                –ü–µ—Ä–µ–π—Ç–∏ –∫ –≤—Ö–æ–¥—É
                            </button>
                        `;
                    })
                    .catch((error) => {
                        document.getElementById('signin-status').innerHTML = `
                            <h1>‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è</h1>
                            <p>–°—Å—ã–ª–∫–∞ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞ –∏–ª–∏ —É—Å—Ç–∞—Ä–µ–ª–∞.</p>
                            <button onclick="location.href='learning.html'" style="background: #1976D2; color: white; border: none; padding: 15px 30px; border-radius: 25px; font-size: 18px; cursor: pointer; margin-top: 20px;">
                                –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
                            </button>
                        `;
                    });
            } else if (firebase.auth().isSignInWithEmailLink(window.location.href)) {
                let email = window.localStorage.getItem('emailForSignIn');
                if (!email) {
                    email = window.prompt('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à email –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è');
                }

                firebase.auth().signInWithEmailLink(email, window.location.href)
                    .then((result) => {
                        window.localStorage.removeItem('emailForSignIn');
                        document.getElementById('signin-status').innerHTML = `
                            <h1>‚úÖ –í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!</h1>
                            <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${email}!</p>
                            <button onclick="location.href='learning.html'" style="background: #1976D2; color: white; border: none; padding: 15px 30px; border-radius: 25px; font-size: 18px; cursor: pointer; margin-top: 20px;">
                                –ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–±—É—á–µ–Ω–∏—é
                            </button>
                        `;
                    })
                    .catch((error) => {
                        console.error('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞:', error);
                        document.getElementById('signin-status').innerHTML = `
                            <h1>‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞</h1>
                            <p>${error.message}</p>
                            <button onclick="location.href='learning.html'" style="background: #1976D2; color: white; border: none; padding: 15px 30px; border-radius: 25px; font-size: 18px; cursor: pointer; margin-top: 20px;">
                                –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
                            </button>
                        `;
                    });
            } else {
                document.getElementById('signin-status').innerHTML = `
                    <h1>üîó –ù–µ–≤–µ—Ä–Ω–∞—è —Å—Å—ã–ª–∫–∞</h1>
                    <p>–≠—Ç–∞ —Å—Å—ã–ª–∫–∞ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞ –∏–ª–∏ —É—Å—Ç–∞—Ä–µ–ª–∞</p>
                    <button onclick="location.href='learning.html'" style="background: #1976D2; color: white; border: none; padding: 15px 30px; border-radius: 25px; font-size: 18px; cursor: pointer; margin-top: 20px;">
                        –ù–∞ –≥–ª–∞–≤–Ω—É—é
                    </button>
                `;
            }
        });
    </script>
</body>
</html>
